buildscript {
  ext.getExtOrDefault = {name ->
    return rootProject.ext.has(name) ? rootProject.ext.get(name) : project.properties['BuildersWallet_' + name]
  }

  repositories {
    google()
    mavenCentral()
  }

  dependencies {
    classpath "com.android.tools.build:gradle:8.7.2"
    // noinspection DifferentKotlinGradleVersion
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:${getExtOrDefault('kotlinVersion')}"
  }
}


apply plugin: "com.android.library"
apply plugin: "kotlin-android"

apply plugin: "com.facebook.react"

def getExtOrIntegerDefault(name) {
  return rootProject.ext.has(name) ? rootProject.ext.get(name) : (project.properties["BuildersWallet_" + name]).toInteger()
}

android {
  namespace "com.builders.wallet"

  compileSdkVersion getExtOrIntegerDefault("compileSdkVersion")

  defaultConfig {
    minSdkVersion getExtOrIntegerDefault("minSdkVersion")
    targetSdkVersion getExtOrIntegerDefault("targetSdkVersion")
  }

  buildFeatures {
    buildConfig true
  }

  buildTypes {
    release {
      minifyEnabled false
    }
  }

  lintOptions {
    disable "GradleCompatible"
  }

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }

  sourceSets {
    main {
      java.srcDirs += [
        "generated/java",
        "generated/jni"
      ]
    }
  }
}

repositories {
  mavenCentral()
  google()
}

def kotlin_version = getExtOrDefault("kotlinVersion")

dependencies {
  implementation "com.facebook.react:react-android"
  implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
}

// Adiciona Google Play Services Tap and Pay condicionalmente
// Só adiciona se a propriedade estiver definida como true
if (project.hasProperty('includeGooglePlayServices') && 
    project.property('includeGooglePlayServices') == 'true') {
  dependencies {
    implementation 'com.google.android.gms:play-services-tapandpay:+'
  }
  println "✅ Google Play Services Tap and Pay incluído"
} else {
  println "⚠️ Google Play Services Tap and Pay não incluído (defina includeGooglePlayServices=true para incluir)"
}

// Adiciona Samsung Pay SDK condicionalmente
// Só adiciona se a propriedade estiver definida como true
if (project.hasProperty('enableSamsungPay') && 
    project.property('enableSamsungPay') == 'true') {
  
  def samsungPayVersion = project.hasProperty('samsungPayVersion') ? 
    project.property('samsungPayVersion') : '2.22.00'
  
  // Tenta encontrar o JAR na pasta libs do app que está usando esta biblioteca
  def appLibsPath = "${rootProject.projectDir}/android/app/libs"
  def samsungPayJar = "samsungpay_${samsungPayVersion}.jar"
  def jarFile = "${appLibsPath}/${samsungPayJar}"
  
  if (new File(jarFile).exists()) {
    println "✅ Samsung Pay SDK encontrado em: ${jarFile}"
  } else {
    println "⚠️ Samsung Pay SDK não encontrado em: ${jarFile}"
    println "⚠️ Certifique-se de que o arquivo ${samsungPayJar} está na pasta android/app/libs do seu app"
    jarFile = null
  }
  
  if (jarFile) {
    dependencies {
      implementation files(jarFile)
    }
    println "✅ Samsung Pay SDK v${samsungPayVersion} incluído de: ${jarFile}"
  }
} else {
  println "⚠️ Samsung Pay SDK não incluído (defina enableSamsungPay=true para incluir)"
}
